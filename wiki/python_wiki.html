<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2019-03-18 一 16:39 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Python wiki</title>
<meta name="generator" content="Org mode" />
<meta name="author" content="pengpengxp" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<link rel="stylesheet" type="text/css" href="http://pengpengxp.github.io/css/wiki.css" />
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2018 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<h1 class="title">Python wiki</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#orgf8c3c97">1. 序列</a></li>
<li><a href="#org4765227">2. 字典</a></li>
<li><a href="#org435183e">3. 对象赋值：</a></li>
<li><a href="#orgc6b0d01">4. 列表解析式</a></li>
<li><a href="#org1a17060">5. 生成器表达式</a></li>
<li><a href="#org2674b55">6. 包和搜索路径</a></li>
<li><a href="#org7a33b55">7. pycharm快捷键</a></li>
<li><a href="#org8cd66cd">8. help</a></li>
<li><a href="#orgc729e14">9. pdb的一种特殊用法</a></li>
<li><a href="#orgdd3d4e4">10. 一个难搞的bug</a></li>
<li><a href="#org29d3557">11. json的使用</a></li>
<li><a href="#org3acc1f9">12. 编程规范</a>
<ul>
<li><a href="#orgbd32a76">12.1. 函数注释</a></li>
<li><a href="#orgac1a9d0">12.2. 类注释</a></li>
<li><a href="#orgc88739f">12.3. 命名规范</a></li>
</ul>
</li>
<li><a href="#org3930e12">13. use gnu global for python</a></li>
<li><a href="#orgd5bfbdf">14. 使用setuptools作egg包</a></li>
<li><a href="#org7c71724">15. staticmethod和classmethod的区别</a></li>
<li><a href="#org1d3b56e">16. <span class="todo TODO">TODO</span> compile exec eval</a></li>
<li><a href="#org64fb368">17. 调用外部程序</a>
<ul>
<li><a href="#org06ee7a8">17.1. Popen</a></li>
</ul>
</li>
<li><a href="#org26c1b47">18. float保留小数点后两位</a></li>
<li><a href="#org6f2edf4">19. pip和easy<sub>install的区别</sub></a></li>
<li><a href="#orgaa94cf2">20. sort</a></li>
<li><a href="#orgae2baa9">21. 哈希算法（摘要算法）</a></li>
<li><a href="#org304e6b9">22. struct</a></li>
<li><a href="#orgef055cf">23. 得到当前执行文件的绝对路径</a></li>
<li><a href="#org4bb6a7f">24. base64和random</a></li>
<li><a href="#org93bef2f">25. pip 相关</a>
<ul>
<li><a href="#org62ce708">25.1. wheel是个什么东西</a></li>
<li><a href="#org817637f">25.2. pip install后不使用cache安装</a></li>
<li><a href="#org053c553">25.3. 结合pip进行离线安装</a></li>
<li><a href="#org03907cb">25.4. 使用阿里源</a></li>
</ul>
</li>
<li><a href="#orgba62fd2">26. print打印字典的特殊用法</a></li>
<li><a href="#orge5a163e">27. 设置源文件编码</a></li>
<li><a href="#orgf1c9f5c">28. python多继承的查找顺序</a></li>
<li><a href="#org9ca63b1">29. 使用dis模块来查看python字节码</a></li>
<li><a href="#orgb6a24bc">30. tornado</a></li>
<li><a href="#org9e89e3b">31. vobject可以操作vCards文件</a></li>
<li><a href="#org85809e6">32. python解析html</a></li>
</ul>
</div>
</div>

<div id="outline-container-orgf8c3c97" class="outline-2">
<h2 id="orgf8c3c97"><span class="section-number-2">1</span> 序列</h2>
<div class="outline-text-2" id="text-1">
<p>
元组中的元素是不可对其赋值的。
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #8fbc8f;">a</span> = (1,2,3)
<span style="color: PaleYellow;">print</span>(a)
</pre>
</div>

<p>
列表中的元素可以被赋值。
</p>
<div class="org-src-container">
<pre class="src src-python">    <span style="color: #8fbc8f;">a</span> = [ 1,2,3 ]
    <span style="color: PaleYellow;">print</span>(a)
</pre>
</div>
</div>
</div>

<div id="outline-container-org4765227" class="outline-2">
<h2 id="org4765227"><span class="section-number-2">2</span> 字典</h2>
<div class="outline-text-2" id="text-2">
<p>
使用dict和copy.copy来从已存在的字典里复制内容来生成新字典，新字典是
浅拷贝版本。
</p>

<p>
字典是hash。
</p>
<div class="org-src-container">
<pre class="src src-python">    <span style="color: #8fbc8f;">tel</span> = {<span style="color: #ffa500;">'jack'</span>: 4098, <span style="color: #ffa500;">'sape'</span>: 4139}
    <span style="color: PaleYellow;">print</span>(tel[<span style="color: #ffa500;">'jack'</span>])
</pre>
</div>

<p>
字典的keys默认是无序的，所以如果对顺序有要求，遍历字典的时候最好先排
序一下， <code>python 2.4</code> 后可以使用 <code>sorted</code> 函数来搞定：
</p>
<div class="org-src-container">
<pre class="src src-python">    <span style="color: #8fbc8f;">a</span> = <span style="color: #b0c4de;">dict</span>(x=1,y=3)
    <span style="color: PaleYellow;">print</span> a

    <span style="color: PaleYellow;">for</span> i <span style="color: PaleYellow;">in</span> <span style="color: #b0c4de;">sorted</span>(a):
        <span style="color: PaleYellow;">print</span> <span style="color: #ffa500;">'%s is %s'</span> % (i, a[i])
</pre>
</div>
</div>
</div>

<div id="outline-container-org435183e" class="outline-2">
<h2 id="org435183e"><span class="section-number-2">3</span> 对象赋值：</h2>
<div class="outline-text-2" id="text-3">
<div class="org-src-container">
<pre class="src src-python">    <span style="color: #8fbc8f;">will</span> = [<span style="color: #ffa500;">"Will"</span>, 28, [<span style="color: #ffa500;">"Python"</span>, <span style="color: #ffa500;">"C#"</span>, <span style="color: #ffa500;">"JavaScript"</span>]]
    <span style="color: #8fbc8f;">wilber</span> = will
    <span style="color: PaleYellow;">print</span> <span style="color: #b0c4de;">id</span>(will)
    <span style="color: PaleYellow;">print</span> will
    <span style="color: PaleYellow;">print</span> [<span style="color: #b0c4de;">id</span>(ele) <span style="color: PaleYellow;">for</span> ele <span style="color: PaleYellow;">in</span> will]
    <span style="color: PaleYellow;">print</span> <span style="color: #b0c4de;">id</span>(wilber)
    <span style="color: PaleYellow;">print</span> wilber
    <span style="color: PaleYellow;">print</span> [<span style="color: #b0c4de;">id</span>(ele) <span style="color: PaleYellow;">for</span> ele <span style="color: PaleYellow;">in</span> wilber]

    <span style="color: PaleYellow;">print</span> <span style="color: #ffa500;">''</span>

    <span style="color: #8fbc8f;">will</span>[0] = <span style="color: #ffa500;">"Wilber"</span>
    will[2].append(<span style="color: #ffa500;">"CSS"</span>)
    <span style="color: PaleYellow;">print</span> <span style="color: #b0c4de;">id</span>(will)
    <span style="color: PaleYellow;">print</span> will
    <span style="color: PaleYellow;">print</span> [<span style="color: #b0c4de;">id</span>(ele) <span style="color: PaleYellow;">for</span> ele <span style="color: PaleYellow;">in</span> will]
    <span style="color: PaleYellow;">print</span> <span style="color: #b0c4de;">id</span>(wilber)
    <span style="color: PaleYellow;">print</span> wilber
    <span style="color: PaleYellow;">print</span> [<span style="color: #b0c4de;">id</span>(ele) <span style="color: PaleYellow;">for</span> ele <span style="color: PaleYellow;">in</span> wilber]
</pre>
</div>

<div class="figure">
<p><img src="./images/./365qOe.png" alt="365qOe.png" />
</p>
</div>
</div>
</div>
<div id="outline-container-orgc6b0d01" class="outline-2">
<h2 id="orgc6b0d01"><span class="section-number-2">4</span> 列表解析式</h2>
<div class="outline-text-2" id="text-4">
<p>
其实就是一个把一个lambda表达式map到列表中的每个元素。
</p>
<div class="org-src-container">
<pre class="src src-python">    <span style="color: PaleYellow;">print</span> <span style="color: #b0c4de;">map</span>(<span style="color: PaleYellow;">lambda</span> x: x ** 2, <span style="color: #b0c4de;">range</span>(6))
    <span style="color: PaleYellow;">print</span> [x ** 2 <span style="color: PaleYellow;">for</span> x <span style="color: PaleYellow;">in</span> <span style="color: #b0c4de;">range</span>(6)]
</pre>
</div>

<p>
加上if也就是加了一个过滤器：
</p>
<div class="org-src-container">
<pre class="src src-python">    <span style="color: PaleYellow;">print</span> <span style="color: #b0c4de;">filter</span>(<span style="color: PaleYellow;">lambda</span> x: x % 2, <span style="color: #b0c4de;">range</span>(10))
    <span style="color: PaleYellow;">print</span> [x <span style="color: PaleYellow;">for</span> x <span style="color: PaleYellow;">in</span> <span style="color: #b0c4de;">range</span>(10) <span style="color: PaleYellow;">if</span> x % 2]
</pre>
</div>
</div>
</div>

<div id="outline-container-org1a17060" class="outline-2">
<h2 id="org1a17060"><span class="section-number-2">5</span> 生成器表达式</h2>
<div class="outline-text-2" id="text-5">
<p>
和列表表达式差不多，只不过通过延迟计算，可以更加省内存，下面这段代码
会把 <code>/etc/hosts</code> 全部读入内存：
</p>
<div class="org-src-container">
<pre class="src src-python">    <span style="color: #8fbc8f;">f</span> = <span style="color: #b0c4de;">open</span>(<span style="color: #ffa500;">'/etc/hosts'</span>)
    <span style="color: #8fbc8f;">allLineLens</span> = [<span style="color: #b0c4de;">len</span>(x) <span style="color: PaleYellow;">for</span> x <span style="color: PaleYellow;">in</span> f]
    f.close()
    <span style="color: PaleYellow;">print</span> <span style="color: #b0c4de;">max</span>(allLineLens)
</pre>
</div>

<p>
改成生成器表达式能优化：
</p>
<div class="org-src-container">
<pre class="src src-python">    <span style="color: #8fbc8f;">f</span> = <span style="color: #b0c4de;">open</span>(<span style="color: #ffa500;">'/etc/hosts'</span>)
    <span style="color: #8fbc8f;">longest</span> = <span style="color: #b0c4de;">max</span>(<span style="color: #b0c4de;">len</span>(x) <span style="color: PaleYellow;">for</span> x <span style="color: PaleYellow;">in</span> f)
    f.close()
    <span style="color: PaleYellow;">print</span> longest
</pre>
</div>
</div>
</div>

<div id="outline-container-org2674b55" class="outline-2">
<h2 id="org2674b55"><span class="section-number-2">6</span> 包和搜索路径</h2>
<div class="outline-text-2" id="text-6">
<p>
python有自己的默认的一些搜索路径。shell中的搜索路径新增可以在
<code>PYTHONPATH</code> 这个环境变量中加入。
</p>
<div class="org-src-container">
<pre class="src src-sh">    <span style="color: #b0c4de;">export</span> <span style="color: #8fbc8f;">PYTHONPATH</span>=<span style="color: #ffa500;">'/path'</span>:$<span style="color: #8fbc8f;">PYTHONPATH</span>
</pre>
</div>

<p>
python代码中可以在sys.path中加入：
</p>
<div class="org-src-container">
<pre class="src src-python">    <span style="color: PaleYellow;">import</span> sys
    sys.path.append(<span style="color: #ffa500;">'path'</span>)
</pre>
</div>

<p>
如果一个目录中有名为 <code>__init__.py</code> 的文件，哪怕它里面什么都没有。
python都会把它当成一个包。子目录中也有该文件，则子目录就是它的子包。
如果把一个包（如rcs）的路径加入 <code>PYTHONPATH</code> 中后，就可以直接引用包
中的内容了：
</p>
<div class="org-src-container">
<pre class="src src-python">    <span style="color: PaleYellow;">from</span>  rcs.service.xxx <span style="color: PaleYellow;">import</span> xxx
</pre>
</div>
<p>
这上面，rcs为一个包，service是它的子包，xxx是service中的子包。
</p>
</div>
</div>
<div id="outline-container-org7a33b55" class="outline-2">
<h2 id="org7a33b55"><span class="section-number-2">7</span> <a href="http://www.jianshu.com/p/be0bdc02f7da">pycharm快捷键</a></h2>
<div class="outline-text-2" id="text-7">
<ol class="org-ol">
<li>cmd b 跳转到声明处（cmd加鼠标）</li>
<li>opt + 空格 显示符号代码 （esc退出窗口 回车进入代码）</li>
<li>cmd []光标之前/后的位置</li>
<li>opt + F7 find usage</li>
<li>cmd backspace 删除当前行</li>
<li>cmd +c 复制光标当前行,剪切同理</li>
<li>cmd + f 当前文件搜索（回车下一个 shift回车上一个）</li>
<li>cmd + r 当前文件替换</li>
<li>shift + cmd + f 全局搜索</li>
<li>shift + cmd + R 全局替换</li>
<li>cmd+o 搜索class</li>
<li>shift + cmd + o 搜索文件</li>
<li>opt + cmd + o 搜索符号（函数等)</li>
<li>cmd + l 指定行数跳转</li>
<li>shift enter 在行中的时候直接到下一行</li>
<li>cmd + 展开当前</li>
<li>cmd - 折叠当前</li>
<li>shift cmd + 展开所有</li>
<li>shift cmd - 折叠所有</li>
<li>cmd / 注释/取消注释一行</li>
<li>opt + cmd + / 批量注释(pycharm不生效)</li>
<li>ctr + tab 史上最NB的导航窗口（工程文件列表、文件结构列表、命令行模式、代码检查、VCS等，下面两个是可以被替换的）</li>
<li>alt + F12 打开命令行栏</li>
<li>cmd + F12 显示文件结构</li>
<li>cmd j 代码智能补全</li>
<li>alt + F1 定位编辑文件所在位置:</li>
<li>cmd + F6 更改变量</li>
<li>opt + cmd + t 指定代码被注释语句或者逻辑结构、函数包围</li>
<li>Tab / Shift + Tab 缩进、不缩进当前行</li>
<li>opt + cmd + l 代码块对齐</li>
<li>cmd+d 在下一行复制本行的内容</li>
</ol>
</div>
</div>
<div id="outline-container-org8cd66cd" class="outline-2">
<h2 id="org8cd66cd"><span class="section-number-2">8</span> help</h2>
<div class="outline-text-2" id="text-8">
<p>
python终端里面使用help函数来查询。不过首先得把对应的模块import进来。
</p>
<pre class="example">
    &gt;&gt;&gt; import time
    &gt;&gt;&gt; help(time)
</pre>

<p>
emacs中可以使用 elpy-doc函数来查询。
</p>
</div>
</div>
<div id="outline-container-orgc729e14" class="outline-2">
<h2 id="orgc729e14"><span class="section-number-2">9</span> pdb的一种特殊用法</h2>
<div class="outline-text-2" id="text-9">
<p>
通过pdb直接打断点来调试就不说了。下面这样写，程序一直运行时，通过发
送一个 <code>SIGUSR1</code> 信号来停住程序。只是记录一下。但是如果程序不是当前
终端拉起的，还不知道怎么可以进到pdb中去。如果是当前终端拉起的，直接
使用fg把程序调到前台来就是了。
</p>
<div class="org-src-container">
<pre class="src src-python">    <span style="color: PaleYellow;">import</span> os
    <span style="color: PaleYellow;">import</span> signal
    <span style="color: PaleYellow;">import</span> sys
    <span style="color: PaleYellow;">import</span> time

    <span style="color: PaleYellow;">def</span> <span style="color: #9acd32;">handle_pdb</span>(sig, frame):
        <span style="color: PaleYellow;">import</span> pdb
        pdb.Pdb().set_trace(frame)

    <span style="color: PaleYellow;">def</span> <span style="color: #9acd32;">loop</span>():
        <span style="color: PaleYellow;">while</span> <span style="color: #7fffd4;">True</span>:
            <span style="color: #8fbc8f;">x</span> = <span style="color: #ffa500;">'foo'</span>
            time.sleep(0.2)

    <span style="color: PaleYellow;">if</span> <span style="color: #b0c4de;">__name__</span> == <span style="color: #ffa500;">'__main__'</span>:
        signal.signal(signal.SIGUSR1, handle_pdb)
        <span style="color: PaleYellow;">print</span>(os.getpid())
        loop()
</pre>
</div>
</div>
</div>
<div id="outline-container-orgdd3d4e4" class="outline-2">
<h2 id="orgdd3d4e4"><span class="section-number-2">10</span> 一个难搞的bug</h2>
<div class="outline-text-2" id="text-10">
<p>
错误的写法，最后 <code>collection</code> 中的内容全是一样的：
</p>
<div class="org-src-container">
<pre class="src src-python">    <span style="color: #8fbc8f;">a</span> = <span style="color: #b0c4de;">range</span>(10)
    <span style="color: #8fbc8f;">collection</span> = []
    <span style="color: #8fbc8f;">temp</span> = {}
    <span style="color: PaleYellow;">for</span> i <span style="color: PaleYellow;">in</span> a:
        <span style="color: #8fbc8f;">temp</span>[<span style="color: #ffa500;">'site'</span>] = i
        collection.append(temp)
    <span style="color: PaleYellow;">print</span> collection
</pre>
</div>

<p>
正确的写法：
</p>
<div class="org-src-container">
<pre class="src src-python">    <span style="color: #8fbc8f;">a</span> = <span style="color: #b0c4de;">range</span>(10)
    <span style="color: #8fbc8f;">collection</span> = []
    <span style="color: PaleYellow;">for</span> i <span style="color: PaleYellow;">in</span> a:
        <span style="color: #8fbc8f;">temp</span> = {}
        <span style="color: #8fbc8f;">temp</span>[<span style="color: #ffa500;">'site'</span>] = i
        collection.append(temp)
    <span style="color: PaleYellow;">print</span> collection
</pre>
</div>
</div>
</div>
<div id="outline-container-org29d3557" class="outline-2">
<h2 id="org29d3557"><span class="section-number-2">11</span> json的使用</h2>
<div class="outline-text-2" id="text-11">
<p>
具体有两个函数： <code>json.loads</code> 和 <code>json.dumps</code> 。
</p>

<div class="org-src-container">
<pre class="src src-python">    <span style="color: #8fbc8f;">json_string</span> = <span style="color: #ffa500;">'{"first_name": "Guido", "last_name":"Rossum"}'</span>
    <span style="color: PaleYellow;">import</span> json
    <span style="color: #8fbc8f;">parsed_json</span> = json.loads(json_string)
    <span style="color: PaleYellow;">print</span>(parsed_json[<span style="color: #ffa500;">'first_name'</span>])
    <span style="color: #8fbc8f;">d</span> = {
        <span style="color: #ffa500;">'first_name'</span>: <span style="color: #ffa500;">'Guido'</span>,
        <span style="color: #ffa500;">'second_name'</span>: <span style="color: #ffa500;">'Rossum'</span>,
        <span style="color: #ffa500;">'titles'</span>: [<span style="color: #ffa500;">'BDFL'</span>, <span style="color: #ffa500;">'Developer'</span>],
    }

    <span style="color: PaleYellow;">print</span>(json.dumps(d))
    <span style="color: PaleYellow;">print</span>(<span style="color: #b0c4de;">type</span>(json.dumps(d)))
</pre>
</div>
</div>
</div>
<div id="outline-container-org3acc1f9" class="outline-2">
<h2 id="org3acc1f9"><span class="section-number-2">12</span> 编程规范</h2>
<div class="outline-text-2" id="text-12">
</div>
<div id="outline-container-orgbd32a76" class="outline-3">
<h3 id="orgbd32a76"><span class="section-number-3">12.1</span> 函数注释</h3>
<div class="outline-text-3" id="text-12-1">
<div class="org-src-container">
<pre class="src src-python">    <span style="color: PaleYellow;">def</span> <span style="color: #9acd32;">fetch_bigtable_rows</span>(big_table, keys, other_silly_variable=<span style="color: #7fffd4;">None</span>):
        <span style="color: #ffa500;">"""Fetches rows from a Bigtable.</span>

<span style="color: #ffa500;">        Retrieves rows pertaining to the given keys from the Table instance</span>
<span style="color: #ffa500;">        represented by big_table.  Silly things may happen if</span>
<span style="color: #ffa500;">        other_silly_variable is not None.</span>

<span style="color: #ffa500;">        Args:</span>
<span style="color: #ffa500;">            big_table: An open Bigtable Table instance.</span>
<span style="color: #ffa500;">            keys: A sequence of strings representing the key of each table row</span>
<span style="color: #ffa500;">                to fetch.</span>
<span style="color: #ffa500;">            other_silly_variable: Another optional variable, that has a much</span>
<span style="color: #ffa500;">                longer name than the other args, and which does nothing.</span>

<span style="color: #ffa500;">        Returns:</span>
<span style="color: #ffa500;">            A dict mapping keys to the corresponding table row data</span>
<span style="color: #ffa500;">            fetched. Each row is represented as a tuple of strings. For</span>
<span style="color: #ffa500;">            example:</span>

<span style="color: #ffa500;">            {'Serak': ('Rigel VII', 'Preparer'),</span>
<span style="color: #ffa500;">             'Zim': ('Irk', 'Invader'),</span>
<span style="color: #ffa500;">             'Lrrr': ('Omicron Persei 8', 'Emperor')}</span>

<span style="color: #ffa500;">            If a key from the keys argument is missing from the dictionary,</span>
<span style="color: #ffa500;">            then that row was not found in the table.</span>

<span style="color: #ffa500;">        Raises:</span>
<span style="color: #ffa500;">            IOError: An error occurred accessing the bigtable.Table object.</span>
<span style="color: #ffa500;">        """</span>
        <span style="color: PaleYellow;">pass</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgac1a9d0" class="outline-3">
<h3 id="orgac1a9d0"><span class="section-number-3">12.2</span> 类注释</h3>
<div class="outline-text-3" id="text-12-2">
<div class="org-src-container">
<pre class="src src-python">    <span style="color: PaleYellow;">class</span> <span style="color: #00ff00;">SampleClass</span>(<span style="color: #b0c4de;">object</span>):
        <span style="color: #ffa500;">"""Summary of class here.</span>

<span style="color: #ffa500;">        Longer class information....</span>
<span style="color: #ffa500;">        Longer class information....</span>

<span style="color: #ffa500;">        Attributes:</span>
<span style="color: #ffa500;">            likes_spam: A boolean indicating if we like SPAM or not.</span>
<span style="color: #ffa500;">            eggs: An integer count of the eggs we have laid.</span>
<span style="color: #ffa500;">        """</span>

        <span style="color: PaleYellow;">def</span> <span style="color: #9acd32;">__init__</span>(<span style="color: PaleYellow;">self</span>, likes_spam=<span style="color: #7fffd4;">False</span>):
            <span style="color: #ffa500;">"""Inits SampleClass with blah."""</span>
            <span style="color: PaleYellow;">self</span>.likes_spam = likes_spam
            <span style="color: PaleYellow;">self</span>.eggs = 0

        <span style="color: PaleYellow;">def</span> <span style="color: #9acd32;">public_method</span>(<span style="color: PaleYellow;">self</span>):
            <span style="color: #ffa500;">"""Performs operation blah."""</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc88739f" class="outline-3">
<h3 id="orgc88739f"><span class="section-number-3">12.3</span> 命名规范</h3>
<div class="outline-text-3" id="text-12-3">
<pre class="example">
    module_name, package_name, ClassName, method_name, ExceptionName,
    function_name, GLOBAL_VAR_NAME, instance_var_name,
    function_parameter_name, local_var_name.

    命名约定

    所谓”内部(Internal)”表示仅模块内可用, 或者, 在类内是保护或私有的. 用
    单下划线(_)开头表示模块变量或函数是protected的(使用import * from时不会
    包含). 用双下划线(__)开头的实例变量或方法表示类内私有. 将相关的类和顶
    级函数放在同一个模块里. 不像Java, 没必要限制一个类一个模块. 对类名使用
    大写字母开头的单词(如CapWords, 即Pascal风格), 但是模块名应该用小写加下
    划线的方式(如lower_with_under.py). 尽管已经有很多现存的模块使用类似于
    CapWords.py这样的命名, 但现在已经不鼓励这样做, 因为如果模块名碰巧和类
    名一致, 这会让人困扰.
</pre>

<p>
Python之父Guido推荐的规范:
</p>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left">Modules</td>
<td class="org-left">lower<sub>with</sub><sub>under</sub></td>
<td class="org-left">_lower<sub>with</sub><sub>under</sub></td>
</tr>

<tr>
<td class="org-left">Packages</td>
<td class="org-left">lower<sub>with</sub><sub>under</sub></td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">Classes</td>
<td class="org-left">CapWords</td>
<td class="org-left">_CapWords</td>
</tr>

<tr>
<td class="org-left">Exceptions</td>
<td class="org-left">CapWords</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">Functions</td>
<td class="org-left">lower<sub>with</sub><sub>under</sub>()</td>
<td class="org-left">_lower<sub>with</sub><sub>under</sub>()</td>
</tr>

<tr>
<td class="org-left">Global/Class Constants</td>
<td class="org-left">CAPS<sub>WITH</sub><sub>UNDER</sub></td>
<td class="org-left">_CAPS<sub>WITH</sub><sub>UNDER</sub></td>
</tr>

<tr>
<td class="org-left">Global/Class Variables</td>
<td class="org-left">lower<sub>with</sub><sub>under</sub></td>
<td class="org-left">_lower<sub>with</sub><sub>under</sub></td>
</tr>

<tr>
<td class="org-left">Instance Variables</td>
<td class="org-left">lower<sub>with</sub><sub>under</sub></td>
<td class="org-left">_lower<sub>with</sub><sub>under</sub> (protected) or _<sub>lower</sub><sub>with</sub><sub>under</sub> (private)</td>
</tr>

<tr>
<td class="org-left">Method Names</td>
<td class="org-left">lower<sub>with</sub><sub>under</sub>()</td>
<td class="org-left">_lower<sub>with</sub><sub>under</sub>() (protected) or _<sub>lower</sub><sub>with</sub><sub>under</sub>() (private)</td>
</tr>

<tr>
<td class="org-left">Function/Method Parameters</td>
<td class="org-left">lower<sub>with</sub><sub>under</sub></td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">Local Variables</td>
<td class="org-left">lower<sub>with</sub><sub>under</sub></td>
<td class="org-left">&#xa0;</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>

<div id="outline-container-org3930e12" class="outline-2">
<h2 id="org3930e12"><span class="section-number-2">13</span> use gnu global for python</h2>
<div class="outline-text-2" id="text-13">
<p>
as official doc says:
</p>
<pre class="example">
    supports 6 languages by built-in parser. (definition and reference) C,
    C++, Yacc, Java, PHP4 and assembly.

    supports 25 languages by Pygments + Universal Ctags plug-in
    parser. (definition and reference) Awk, Dos batch, COBOL, C, C++, C#,
    Erlang, Fortran, Java, JavaScript, Lisp, Lua, Pascal, Perl, PHP,
    Python, Ruby, Matlab, OCaml, Scheme, Tcl, TeX, Verilog, Vhdl and Vim.
    To use the parser, please see the file
    'plugin-factory/PLUGIN_HOWTO.pygments' in the package.
</pre>

<pre class="example">
    ___________________________________
    |      |  |  |     |  _  |     |  |
    |  |___|  |  |  |  |    _|  |  |  |    GNU GLOBAL source code tag system
    |  |   |  |  |  |  |     |     |  |
    |  ~~  |   ~~|     |  ~  |  |  |   ~~|          for all hackers.
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
     Copyright (c) 2014 Tama Communications Corporation

     This file is free software; as a special exception the author gives
     unlimited permission to copy and/or distribute it, with or without
     modifications, as long as this notice is preserved.

     This program is distributed in the hope that it will be useful, but
     WITHOUT ANY WARRANTY, to the extent permitted by law; without even the
     implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.

                    ----------------------------------

    How to use Pygments Plug-in Parser

    Pygments is a generic syntax highlighter for wide variety of
    programming languages. This plug-in use Pygments and Exuberant
    Ctags as a parser to treat both definitions and references.

    You need the following software:
    o Python 2.6 or later (3 is also supported)
    o Pygments python package 1.6 or later
    o Exuberant Ctags 5.5 or later (optional)

    [Installation]

    1. Check

    Make sure python and ctags can be invoked in your command line.
    $ type python
    python is /usr/bin/python
    $ type ctags
    ctags is /usr/local/bin/ctags

    2. Installation of GLOBAL

    $ ./configure
    $ make
    $ sudo make install

    3. Setup of Pygments plug-in parser

    The definition of Pygments plug-in parser is prepared
    in the default configuration file. Please specify it.

    $ export GTAGSCONF=/usr/local/share/gtags/gtags.conf
    $ export GTAGSLABEL=pygments

    [Execution of gtags]

    Please execute gtags(1) as usual.

    $ gtags

    If it is doubtful whether Pygments plug-in parser is used,
    please try --explain option. It shows the libraries used by
    gtags.

    $ gtags --explain
    ...
    File './lib/xmalloc.c' is handled as follows:
            suffix:   |.c|
            language: |C|
            parser:   |parser|
            library:  |/usr/local/lib/gtags/pygments-parser.la|

                    ----------------------------------

    Pygments plug-in parser was written by Yoshitaro MAKISE.
    For detals, please see the following site:
    [https://github.com/yoshizow/global-pygments-plugin]

    Though it is considered a separate package, not part of GLOBAL proper,
    we included it for user's convenience.
</pre>

<p>
I think use the two `export' command is ok.
</p>

<p>
但是这个我尝试了一下，效果还是不太好。还是使用`cscope'。
</p>
</div>
</div>

<div id="outline-container-orgd5bfbdf" class="outline-2">
<h2 id="orgd5bfbdf"><span class="section-number-2">14</span> 使用setuptools作egg包</h2>
<div class="outline-text-2" id="text-14">
<p>
<a href="http://yansu.org/2013/06/07/learn-python-setuptools-in-detail.html">参考的这里</a>
</p>

<div class="org-src-container">
<pre class="src src-sh">    mkdir demo
    <span style="color: #b0c4de;">cd</span> demo/
    ls
    f setup.py
    python setup.py bdist_egg
</pre>
</div>
<p>
这个可以在dist目录中做出来一个egg包。然后使用 <code>python setup.py
  install</code> 可以直接安装这个包。
</p>

<p>
setup.py里面可以是这样的：
</p>
<div class="org-src-container">
<pre class="src src-python">    <span style="color: PaleYellow;">from</span> setuptools <span style="color: PaleYellow;">import</span> setup, find_packages
    setup(
        name = <span style="color: #ffa500;">"demo"</span>,
        version = <span style="color: #ffa500;">"0.1"</span>,
        packages = find_packages(),
    )
</pre>
</div>
</div>
</div>

<div id="outline-container-org7c71724" class="outline-2">
<h2 id="org7c71724"><span class="section-number-2">15</span> staticmethod和classmethod的区别</h2>
<div class="outline-text-2" id="text-15">
<p>
<a href="http://blog.csdn.net/handsomekang/article/details/9615239">参考的这里</a>
</p>

<ul class="org-ul">
<li><code>@staticmethod</code> 不需要表示自身对象的self和自身类的cls参数，就跟使
用函数一样。</li>
<li><code>@classmethod</code> 也不需要self参数，但第一个参数需要是表示自身类的cls
参数。</li>
</ul>

<p>
如果在@staticmethod中要调用到这个类的一些属性方法，只能直接类名.属性
名或类名.方法名。而@classmethod因为持有cls参数，可以来调用类的属性，
类的方法，实例化对象等，避免硬编码。下面上代码。可以看到，
<code>@classmethod</code> 的cls可以是其它任何值，但这里它其实就是指类型A。
</p>

<div class="org-src-container">
<pre class="src src-python">    <span style="color: PaleYellow;">class</span> <span style="color: #00ff00;">A</span>(<span style="color: #b0c4de;">object</span>):
        <span style="color: #8fbc8f;">bar</span> = 1
        <span style="color: PaleYellow;">def</span> <span style="color: #9acd32;">foo</span>(<span style="color: PaleYellow;">self</span>):
            <span style="color: PaleYellow;">print</span> <span style="color: #ffa500;">'foo'</span>

        <span style="color: #00ff00;">@staticmethod</span>
        <span style="color: PaleYellow;">def</span> <span style="color: #9acd32;">static_foo</span>():
            <span style="color: PaleYellow;">print</span> <span style="color: #ffa500;">'static_foo'</span>
            <span style="color: PaleYellow;">print</span> A.bar

        <span style="color: #00ff00;">@classmethod</span>
        <span style="color: PaleYellow;">def</span> <span style="color: #9acd32;">class_foo</span>(cls):
            <span style="color: PaleYellow;">print</span> <span style="color: #ffa500;">'class_foo'</span>
            <span style="color: PaleYellow;">print</span> cls.bar
            cls().foo()

        <span style="color: #00ff00;">@classmethod</span>
        <span style="color: PaleYellow;">def</span> <span style="color: #9acd32;">class_foo_2</span>(clsa):
            <span style="color: PaleYellow;">print</span> <span style="color: #ffa500;">'class_foo 2'</span>
            <span style="color: PaleYellow;">print</span> clsa.bar
            clsa().foo()

    A.static_foo()
    A.class_foo()
    A.class_foo_2()
</pre>
</div>
</div>
</div>

<div id="outline-container-org1d3b56e" class="outline-2">
<h2 id="org1d3b56e"><span class="section-number-2">16</span> <span class="todo TODO">TODO</span> compile exec eval</h2>
<div class="outline-text-2" id="text-16">
<p>
compile可以把一段代码搞成一个可以执行的对象。
</p>

<p>
<code>compile(source, filename, mode[, flags[, dont_inherit]])¶</code> source是
指需要执行的代码。这中间的filename我没搞懂是干啥的。flags可以是
<code>exec</code> <code>single</code> 和 <code>eval</code> 中的任一个。
</p>

<p>
我还没有搞懂：
</p>
<ol class="org-ol">
<li class="off"><code>[&#xa0;]</code> eval, exec和single的区别</li>
</ol>

<pre class="example">
    The mode argument specifies what kind of code must be compiled;
    it can be 'exec' if source consists of a sequence of statements,
    'eval' if it consists of a single expression, or 'single' if it
    consists of a single interactive statement (in the latter case,
    expression statements that evaluate to something other than None
    will be printed).
</pre>

<p>
下面是例子：
</p>
<div class="org-src-container">
<pre class="src src-python">    <span style="color: #8fbc8f;">a</span> = <span style="color: #b0c4de;">compile</span>(<span style="color: #ffa500;">'print 3'</span>, <span style="color: #ffa500;">''</span>, <span style="color: #ffa500;">'exec'</span>)
    <span style="color: PaleYellow;">exec</span>(a)

    <span style="color: #8fbc8f;">a</span> = <span style="color: #b0c4de;">compile</span>(<span style="color: #ffa500;">'print 3 * 3'</span>, <span style="color: #ffa500;">''</span>, <span style="color: #ffa500;">'exec'</span>)
    <span style="color: PaleYellow;">exec</span>(a)
</pre>
</div>

<p>
execfile可以执行一个文件。假如 <code>/tmp/test.py</code> 是这样的：
</p>
<div class="org-src-container">
<pre class="src src-python">    <span style="color: PaleYellow;">class</span> <span style="color: #00ff00;">A</span>(<span style="color: #b0c4de;">object</span>):
        <span style="color: #8fbc8f;">bar</span> = 1
        <span style="color: PaleYellow;">def</span> <span style="color: #9acd32;">foo</span>(<span style="color: PaleYellow;">self</span>):
            <span style="color: PaleYellow;">print</span> <span style="color: #ffa500;">'foo'</span>

        <span style="color: #00ff00;">@staticmethod</span>
        <span style="color: PaleYellow;">def</span> <span style="color: #9acd32;">static_foo</span>():
            <span style="color: PaleYellow;">print</span> <span style="color: #ffa500;">'static_foo'</span>
            <span style="color: PaleYellow;">print</span> A.bar

        <span style="color: #00ff00;">@classmethod</span>
        <span style="color: PaleYellow;">def</span> <span style="color: #9acd32;">class_foo</span>(cls):
            <span style="color: PaleYellow;">print</span> <span style="color: #ffa500;">'class_foo'</span>
            <span style="color: PaleYellow;">print</span> cls.bar
            cls().foo()

        <span style="color: #00ff00;">@classmethod</span>
        <span style="color: PaleYellow;">def</span> <span style="color: #9acd32;">class_foo_2</span>(clsa):
            <span style="color: PaleYellow;">print</span> <span style="color: #ffa500;">'class_foo 2'</span>
            <span style="color: PaleYellow;">print</span> clsa.bar
            clsa().foo()

    A.static_foo()
    A.class_foo()
    A.class_foo_2()

    <span style="color: PaleYellow;">print</span> <span style="color: #ffa500;">'end'</span>

    <span style="color: #8fbc8f;">x</span> = <span style="color: #ffa500;">'xiepeng'</span>

</pre>
</div>

<div class="org-src-container">
<pre class="src src-python">    <span style="color: #b0c4de;">execfile</span>(<span style="color: #ffa500;">'/tmp/test.py'</span>)
</pre>
</div>

<p>
也可以使把源文件读出来，然后使用compile编一下，再执行：
</p>
<div class="org-src-container">
<pre class="src src-python">    <span style="color: PaleYellow;">with</span> <span style="color: #b0c4de;">open</span>(<span style="color: #ffa500;">'/tmp/test.py'</span>) <span style="color: PaleYellow;">as</span> fn:
        <span style="color: #8fbc8f;">a</span> = fn.read()
        <span style="color: #8fbc8f;">c</span> = <span style="color: #b0c4de;">compile</span>(a, <span style="color: #ffa500;">''</span>, <span style="color: #ffa500;">'exec'</span>)
        <span style="color: PaleYellow;">exec</span>(c)
</pre>
</div>
</div>
</div>

<div id="outline-container-org64fb368" class="outline-2">
<h2 id="org64fb368"><span class="section-number-2">17</span> 调用外部程序</h2>
<div class="outline-text-2" id="text-17">
<p>
使用 <code>subprocess</code> ：
</p>
<pre class="example">
    Examples:

        &gt;&gt;&gt; subprocess.call(["ls", "-l"])
        0

        &gt;&gt;&gt; subprocess.call("exit 1", shell=True)
        1
</pre>

<p>
<code>shell=True</code> 的时候会把程序结果弄出来。比如：
</p>
<div class="org-src-container">
<pre class="src src-python">    <span style="color: PaleYellow;">import</span> subprocess

    subprocess.call(<span style="color: #ffa500;">'ls /tmp/'</span>, shell=<span style="color: #7fffd4;">True</span>)
</pre>
</div>

<p>
<b>注意</b> ： !shell=True! 可能会存在安全问题。 但是使用 !shell=False!
，第一个参数就不能再是string了。需要是一个list。
</p>
<div class="org-src-container">
<pre class="src src-python">    <span style="color: PaleYellow;">import</span> subprocess

    subprocess.call([<span style="color: #ffa500;">'ls'</span>, <span style="color: #ffa500;">'/tmp'</span>], shell=<span style="color: #7fffd4;">False</span>)
</pre>
</div>

<p>
一般是配合 <code>shlex</code> 来使用：
</p>
<div class="org-src-container">
<pre class="src src-python">    <span style="color: PaleYellow;">import</span> shlex
    <span style="color: PaleYellow;">import</span> subprocess

    <span style="color: #8fbc8f;">cmd</span> = <span style="color: #ffa500;">"ls /tmp/"</span>
    <span style="color: PaleYellow;">print</span> shlex.split(cmd)
    subprocess.call(shlex.split(cmd), shell=<span style="color: #7fffd4;">False</span>)
</pre>
</div>
</div>

<div id="outline-container-org06ee7a8" class="outline-3">
<h3 id="org06ee7a8"><span class="section-number-3">17.1</span> Popen</h3>
<div class="outline-text-3" id="text-17-1">
<pre class="example">
     Warning

         This will deadlock when using stdout=PIPE and/or stderr=PIPE and
         the child process generates enough output to a pipe such that it
         blocks waiting for the OS pipe buffer to accept more data. Use
         communicate() to avoid that.
</pre>

<p>
比如这样可能就要锁死：
</p>
<div class="org-src-container">
<pre class="src src-python">     <span style="color: PaleYellow;">import</span> subprocess

     <span style="color: #8fbc8f;">s</span> = subprocess.Popen([<span style="color: #ffa500;">"ps"</span>, <span style="color: #ffa500;">"aux"</span>], stdout=subprocess.PIPE)
     s.wait()
</pre>
</div>

<p>
需要使用 <code>comunicate</code> 来等待就可以：
</p>
<div class="org-src-container">
<pre class="src src-python">     <span style="color: PaleYellow;">import</span> subprocess

     <span style="color: #8fbc8f;">i</span> = 0
     <span style="color: #cd5c5c;"># </span><span style="color: #cd5c5c;">s = subprocess.Popen(["ps", "aux"], stdout=subprocess.PIPE)</span>
     <span style="color: #8fbc8f;">s</span> = subprocess.Popen([<span style="color: #ffa500;">'date'</span>], stdout=subprocess.PIPE)
     <span style="color: PaleYellow;">print</span> <span style="color: #ffa500;">'begin'</span>
     <span style="color: #8fbc8f;">result</span> = s.communicate()
     <span style="color: PaleYellow;">print</span> s.returncode
     <span style="color: PaleYellow;">for</span> line <span style="color: PaleYellow;">in</span> result[0].split(<span style="color: #ffa500;">'\n'</span>):
         <span style="color: PaleYellow;">print</span> i, line
         <span style="color: #8fbc8f;">i</span> = i + 1
</pre>
</div>

<pre class="example">
     Popen.communicate(input=None)¶

         Interact with process: Send data to stdin. Read data from stdout
         and stderr, until end-of-file is reached. Wait for process to
         terminate. The optional input argument should be a string to be
         sent to the child process, or None, if no data should be sent to
         the child.

         communicate() returns a tuple (stdoutdata, stderrdata).

         Note that if you want to send data to the process’s stdin, you
         need to create the Popen object with stdin=PIPE. Similarly, to
         get anything other than None in the result tuple, you need to
         give stdout=PIPE and/or stderr=PIPE too.

         Note

         The data read is buffered in memory, so do not use this method if
         the data size is large or unlimited.

</pre>
</div>
</div>
</div>

<div id="outline-container-org26c1b47" class="outline-2">
<h2 id="org26c1b47"><span class="section-number-2">18</span> float保留小数点后两位</h2>
<div class="outline-text-2" id="text-18">
<div class="org-src-container">
<pre class="src src-python">    <span style="color: #8fbc8f;">s</span> = <span style="color: #ffa500;">'17.23532'</span>
    <span style="color: #8fbc8f;">a</span> = (<span style="color: #ffa500;">"%.2f GB"</span> % <span style="color: #b0c4de;">float</span>(s))
    <span style="color: PaleYellow;">print</span> a
    <span style="color: PaleYellow;">print</span> <span style="color: #b0c4de;">type</span>(a)
</pre>
</div>
</div>
</div>

<div id="outline-container-org6f2edf4" class="outline-2">
<h2 id="org6f2edf4"><span class="section-number-2">19</span> pip和easy<sub>install的区别</sub></h2>
<div class="outline-text-2" id="text-19">
<p>
<a href="https://packaging.python.org/discussions/pip-vs-easy-install/">参考这里</a>
</p>

<p>
<code>easy_install</code> 是在2004发布的，做为python的包管理器，能自动从 <code>PyPi</code>
安装包，自动解决依赖。
</p>

<p>
<code>pip</code> 于2008年发布。目的是做为 <code>easy_install</code> 的替代品。它不再从egg
文件中安装包。而是简单地将软件包从sdist中搞出来。
</p>

<p>
下面列出一些这两者之间重要的区别：
</p>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">&#xa0;</th>
<th scope="col" class="org-left">pip</th>
<th scope="col" class="org-left">easy<sub>install</sub></th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">Installs from Wheels</td>
<td class="org-left">Yes</td>
<td class="org-left">No</td>
</tr>

<tr>
<td class="org-left">Uninstall Packages</td>
<td class="org-left">Yes (pip uninstall)</td>
<td class="org-left">No</td>
</tr>

<tr>
<td class="org-left">Dependency Overrides</td>
<td class="org-left">Yes (Requirements Files)</td>
<td class="org-left">No</td>
</tr>

<tr>
<td class="org-left">List Installed Packages</td>
<td class="org-left">Yes (pip list and pip freeze)</td>
<td class="org-left">No</td>
</tr>

<tr>
<td class="org-left">PEP 438 Support       Yes</td>
<td class="org-left">No</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">Installation format</td>
<td class="org-left">‘Flat’ packages with egg-info metadata.</td>
<td class="org-left">Encapsulated Egg format</td>
</tr>

<tr>
<td class="org-left">sys.path modification</td>
<td class="org-left">No</td>
<td class="org-left">Yes</td>
</tr>

<tr>
<td class="org-left">Installs from Eggs</td>
<td class="org-left">No</td>
<td class="org-left">Yes</td>
</tr>

<tr>
<td class="org-left">pylauncher support</td>
<td class="org-left">No</td>
<td class="org-left">Yes</td>
</tr>

<tr>
<td class="org-left">Multi-version Installs</td>
<td class="org-left">No</td>
<td class="org-left">Yes</td>
</tr>

<tr>
<td class="org-left">Exclude scripts during install</td>
<td class="org-left">No</td>
<td class="org-left">Yes</td>
</tr>

<tr>
<td class="org-left">per project index</td>
<td class="org-left">Only in virtualenv</td>
<td class="org-left">Yes, via setup.cfg</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-orgaa94cf2" class="outline-2">
<h2 id="orgaa94cf2"><span class="section-number-2">20</span> sort</h2>
<div class="outline-text-2" id="text-20">
<pre class="example">
    &gt;&gt;&gt; sorted([5, 2, 3, 1, 4])
    [1, 2, 3, 4, 5]

    list.sort() will change the list:
    &gt;&gt;&gt; a = [5, 2, 3, 1, 4]
    &gt;&gt;&gt; a.sort()
    &gt;&gt;&gt; a
    [1, 2, 3, 4, 5]

    list.sort() is defined for list only. sorted functiona accept any
    iterable:
    &gt;&gt;&gt; sorted({1: 'D', 2: 'B', 3: 'B', 4: 'E', 5: 'A'})
    [1, 2, 3, 4, 5]

    &gt;&gt;&gt; sorted("This is a test string from Andrew".split(), key=str.lower)
    ['a', 'Andrew', 'from', 'is', 'string', 'test', 'This']

    more complicated:
    &gt;&gt;&gt; student_tuples = [
    ...     ('john', 'A', 15),
    ...     ('jane', 'B', 12),
    ...     ('dave', 'B', 10),
    ... ]
    &gt;&gt;&gt; sorted(student_tuples, key=lambda student: student[2])   # sort by age
    [('dave', 'B', 10), ('jane', 'B', 12), ('john', 'A', 15)]

    &gt;&gt;&gt; class Student:
    ...     def __init__(self, name, grade, age):
    ...         self.name = name
    ...         self.grade = grade
    ...         self.age = age
    ...     def __repr__(self):
    ...         return repr((self.name, self.grade, self.age))

    &gt;&gt;&gt; student_objects = [
    ...     Student('john', 'A', 15),
    ...     Student('jane', 'B', 12),
    ...     Student('dave', 'B', 10),
    ... ]
    &gt;&gt;&gt; sorted(student_objects, key=lambda student: student.age)   # sort by age
    [('dave', 'B', 10), ('jane', 'B', 12), ('john', 'A', 15)]

</pre>

<p>
还可以通过加 <code>reverse</code> 参数来反向排序。
</p>
<div class="org-src-container">
<pre class="src src-python">    <span style="color: PaleYellow;">class</span> <span style="color: #00ff00;">person</span>(<span style="color: #b0c4de;">object</span>):
        <span style="color: #ffa500;">"""Documentation for person</span>

<span style="color: #ffa500;">        """</span>
        <span style="color: PaleYellow;">def</span> <span style="color: #9acd32;">__init__</span>(<span style="color: PaleYellow;">self</span>, name, age):
            <span style="color: #b0c4de;">super</span>(person, <span style="color: PaleYellow;">self</span>).__init__()
            <span style="color: PaleYellow;">self</span>.age = age
            <span style="color: PaleYellow;">self</span>.name = name

    <span style="color: #8fbc8f;">a</span> = person(<span style="color: #ffa500;">'xie'</span>, 2)
    <span style="color: #8fbc8f;">b</span> = person(<span style="color: #ffa500;">'peng'</span>, 8)
    <span style="color: #8fbc8f;">c</span> = person(<span style="color: #ffa500;">'ni'</span>, 4)
    <span style="color: #8fbc8f;">d</span> = person(<span style="color: #ffa500;">'hao'</span>, 3)

    <span style="color: #8fbc8f;">l</span> = [a, b, c, d]
    <span style="color: PaleYellow;">print</span> [x.name <span style="color: PaleYellow;">for</span> x <span style="color: PaleYellow;">in</span> l]
    <span style="color: PaleYellow;">print</span> [x.name <span style="color: PaleYellow;">for</span> x <span style="color: PaleYellow;">in</span> <span style="color: #b0c4de;">sorted</span>(l, key=<span style="color: PaleYellow;">lambda</span> x: x.age)]
    <span style="color: PaleYellow;">print</span> [x.name <span style="color: PaleYellow;">for</span> x <span style="color: PaleYellow;">in</span> <span style="color: #b0c4de;">sorted</span>(l, key=<span style="color: PaleYellow;">lambda</span> x: x.age, reverse=<span style="color: #7fffd4;">True</span>)]
</pre>
</div>
</div>
</div>

<div id="outline-container-orgae2baa9" class="outline-2">
<h2 id="orgae2baa9"><span class="section-number-2">21</span> 哈希算法（摘要算法）</h2>
<div class="outline-text-2" id="text-21">
<p>
<a href="http://www.liaoxuefeng.com/wiki/001374738125095c955c1e6d8bb493182103fac9270762a000/0013868328251266d86585fc9514536a638f06b41908d44000">这里有一篇很棒的文章</a>
</p>

<p>
常见的有md5和sha1等。就是一个函数f()，它通过一个函数，把任意长度的数
据转换为一个长度固定的数据串（通常用16进制的字符串表示）。单向的，计
算f(data)很容易，但通过digest反推data却非常困难。
</p>

<p>
比SHA1更安全的算法是SHA256和SHA512，不过越安全的算法越慢，而且摘要长
度更长。
</p>

<p>
有没有可能两个不同的数据通过某个摘要算法得到了相同的摘要？完全有可能，
因为任何摘要算法都是把无限多的数据集合映射到一个有限的集合中。这种情
况称为碰撞，比如Bob试图根据你的摘要反推出一篇文章'how to learn
hashlib in python - by Bob'，并且这篇文章的摘要恰好和你的文章完全一
致，这种情况也并非不可能出现，但是非常非常困难。
</p>

<p>
在后端数据库中，一般不存用户的明文密码，这样可能系统管理员能看到所有
的密码。而是存它的密码的摘要，也就是hash之后的值。用户登陆时，过程应
该是先计算它的密码的摘要，然后对比库中的。这样的好处是即使运维人员能
访问数据库，也无法获知用户的明文口令。
</p>
</div>
</div>
<div id="outline-container-org304e6b9" class="outline-2">
<h2 id="org304e6b9"><span class="section-number-2">22</span> struct</h2>
<div class="outline-text-2" id="text-22">
<p>
<a href="http://www.liaoxuefeng.com/wiki/001374738125095c955c1e6d8bb493182103fac9270762a000/0013994173393204e80af1f8fa94c8e9d094d229395ea43000">廖雪峰的博客写得很详细</a> 我直接引用了。
</p>

<pre class="example">
  准确地讲，Python没有专门处理字节的数据类型。但由于str既是字符串，又
  可以表示字节，所以，字节数组＝str。而在C语言中，我们可以很方便地用
  struct、union来处理字节，以及字节和int，float的转换。

  在Python中，比方说要把一个32位无符号整数变成字节，也就是4个长度的str，
  你得配合位运算符这么写：

    &gt;&gt;&gt; n = 10240099
    &gt;&gt;&gt; b1 = chr((n &amp; 0xff000000) &gt;&gt; 24)
    &gt;&gt;&gt; b2 = chr((n &amp; 0xff0000) &gt;&gt; 16)
    &gt;&gt;&gt; b3 = chr((n &amp; 0xff00) &gt;&gt; 8)
    &gt;&gt;&gt; b4 = chr(n &amp; 0xff)
    &gt;&gt;&gt; s = b1 + b2 + b3 + b4
    &gt;&gt;&gt; s
    '\x00\x9c@c'

  非常麻烦。如果换成浮点数就无能为力了。

  好在Python提供了一个struct模块来解决str和其他二进制数据类型的转换。

  struct的pack函数把任意数据类型变成字符串：

    &gt;&gt;&gt; import struct
    &gt;&gt;&gt; struct.pack('&gt;I', 10240099)
    '\x00\x9c@c'

</pre>
</div>
</div>
<div id="outline-container-orgef055cf" class="outline-2">
<h2 id="orgef055cf"><span class="section-number-2">23</span> 得到当前执行文件的绝对路径</h2>
<div class="outline-text-2" id="text-23">
<p>
有时候需要根据当前执行文件的路径和相对路径来找文件。首先需要得到可执
行文件的绝对路径：
</p>
<div class="org-src-container">
<pre class="src src-python">    <span style="color: PaleYellow;">import</span> os
    <span style="color: PaleYellow;">print</span> os.path.abspath(os.path.dirname(__file__))
    <span style="color: #8fbc8f;">absolute_path</span> = os.path.abspath(os.path.dirname(__file__))
    <span style="color: #8fbc8f;">other_path</span> = os.path.join(os.path.abspath(os.path.dirname(__file__)), <span style="color: #ffa500;">"../xiepeng"</span>)
    <span style="color: PaleYellow;">print</span> other_path
</pre>
</div>
</div>
</div>

<div id="outline-container-org4bb6a7f" class="outline-2">
<h2 id="org4bb6a7f"><span class="section-number-2">24</span> base64和random</h2>
<div class="outline-text-2" id="text-24">
<div class="org-src-container">
<pre class="src src-python">    <span style="color: PaleYellow;">import</span> base64
    <span style="color: PaleYellow;">from</span> Crypto <span style="color: PaleYellow;">import</span> Random

    <span style="color: PaleYellow;">print</span> base64.b64encode(Random.new().read(24))
    <span style="color: PaleYellow;">print</span> <span style="color: #b0c4de;">len</span>(base64.b64encode(Random.new().read(24)))
</pre>
</div>
</div>
</div>
<div id="outline-container-org93bef2f" class="outline-2">
<h2 id="org93bef2f"><span class="section-number-2">25</span> <a href="https://pip.pypa.io/en/stable/quickstart/">pip</a> 相关</h2>
<div class="outline-text-2" id="text-25">
</div>
<div id="outline-container-org62ce708" class="outline-3">
<h3 id="org62ce708"><span class="section-number-3">25.1</span> wheel是个什么东西</h3>
<div class="outline-text-3" id="text-25-1">
<p>
wheel其实是一种内置的归档格式。它比起从源代码编译再安装快很多。pip一
般是优先安装的wheel。使用 <code>--no-binary</code> 可以禁止从wheel安装。如果没
有找到对应的wheel，pip才会选择从源代码安装。
</p>
</div>
</div>

<div id="outline-container-org817637f" class="outline-3">
<h3 id="org817637f"><span class="section-number-3">25.2</span> pip install后不使用cache安装</h3>
<div class="outline-text-3" id="text-25-2">
<p>
<a href="https://stackoverflow.com/questions/9510474/removing-pips-cache">这里</a> 提的一个问题：pip安装一个版本的包，发现版本安装错了，使用 <code>pip
   uninstall</code> 删除后重新安装，发现还是安装原来错误版本的包。原来pip默认
cache了。
要强制不从 <code>cache</code> 安装，需要这样：
</p>
<pre class="example">
     If using pip 6.0 or newer, try adding the --no-cache-dir option.
     If using pip older than pip 6.0, upgrade it with pip install -U pip.
</pre>

<p>
各平台cahce的dir为：
</p>
<pre class="example">
     Unix
     ~/.cache/pip and it respects the XDG_CACHE_HOME directory.
     macOS
     ~/Library/Caches/pip.
     Windows
     &lt;CSIDL_LOCAL_APPDATA&gt;\pip\Cache
</pre>

<p>
<a href="https://pip.pypa.io/en/latest/reference/pip_install/#caching">官方文档在这里</a> 默认cache都是打开的
</p>
</div>
</div>

<div id="outline-container-org053c553" class="outline-3">
<h3 id="org053c553"><span class="section-number-3">25.3</span> 结合pip进行离线安装</h3>
<div class="outline-text-3" id="text-25-3">
<p>
特殊情况下，电脑不能连接外网。需要通过离线的方式安装package。
</p>

<p>
<a href="https://pip.pypa.io/en/stable/user_guide/#installing-from-local-packages">官网教程在这里</a> 。
</p>

<p>
为了做示例，使用 <code>virtualenv</code> 新建一个全新的python环境。
</p>
<div class="org-src-container">
<pre class="src src-sh">     <span style="color: #b0c4de;">cd</span> /tmp/
     mkdir temp
     virtualenv temp
     <span style="color: #b0c4de;">source</span> temp/bin/activate
     which pip
</pre>
</div>

<p>
需要先把对应的包全部下载下来（如果只有一个包，后面直接跟包名就可以
了。不需要 <code>-r</code> 选项）：
</p>
<div class="org-src-container">
<pre class="src src-sh">     mkdir -p /tmp/downloads
     pip install --download /tmp/downloads -r requirements.txt
</pre>
</div>
<p>
<code>pip install --download</code> 会先看看 <code>wheel cache</code> 中有没有对应的软件，
有就用cache中的，没有才从 <code>pypi</code> 下载。如果之前没安装过这些包，那肯
定是没有对应的 <code>wheel cache</code> 的。在这种情况下，有些包在 <code>pypi</code> 中又
不是 <code>wheel</code> 的形式发布的，但是你又确实希望得到 <code>wheel</code> 形式的包。
可以执行下面的命令：
</p>
<div class="org-src-container">
<pre class="src src-sh">     pip wheel --wheel-dir /tmp/downloads_wheel -r requirements.txt
</pre>
</div>

<p>
<b>注意</b> ： <code>pip 9.0</code> 提供了 <code>pip download</code> 命令，它默认下载到当前目
录：它可以取代 <code>pip install --downlaod</code> ，后者会在 <code>pip 10</code> 中被
remove。
</p>

<p>
下面看看这两个命令的区别， <code>downlaods</code> 目录中有 <code>tar.gz</code> ，
<code>downloads_wheel</code> 目录全是 <code>wheel</code> 包：
</p>
<pre class="example">
     $ ls downloads_wheel/
     appdirs-1.4.3-py2.py3-none-any.whl             iso8601-0.1.11-py2.py3-none-any.whl           pbr-3.1.1-py2.py3-none-any.whl            requestsexceptions-1.2.0-py2.py3-none-any.whl
     certifi-2017.4.17-py2.py3-none-any.whl         jsonpatch-1.16-py2.py3-none-any.whl           positional-1.1.1-py2.py3-none-any.whl     six-1.10.0-py2.py3-none-any.whl
     cffi-1.10.0-cp27-cp27mu-manylinux1_x86_64.whl  jsonpointer-1.10-py2-none-any.whl             pycparser-2.17-py2.py3-none-any.whl       stevedore-1.23.0-py2.py3-none-any.whl
     chardet-3.0.4-py2.py3-none-any.whl             keystoneauth1-2.21.0-py2.py3-none-any.whl     PyYAML-3.12-cp27-cp27mu-linux_x86_64.whl  urllib3-1.21.1-py2.py3-none-any.whl
     deprecation-1.0.1-py2-none-any.whl             openstacksdk-0.9.17-py2.py3-none-any.whl      rabbitmq-0.2.0-py2.py3-none-any.whl       wrapt-1.10.10-cp27-cp27mu-linux_x86_64.whl
     idna-2.5-py2.py3-none-any.whl                  os_client_config-1.27.0-py2.py3-none-any.whl  requests-2.18.1-py2.py3-none-any.whl
     $ ls downloads
     appdirs-1.4.3-py2.py3-none-any.whl             iso8601-0.1.11-py2.py3-none-any.whl           pbr-3.1.1-py2.py3-none-any.whl        requestsexceptions-1.2.0-py2.py3-none-any.whl
     certifi-2017.4.17-py2.py3-none-any.whl         jsonpatch-1.16-py2.py3-none-any.whl           positional-1.1.1.tar.gz               six-1.10.0-py2.py3-none-any.whl
     cffi-1.10.0-cp27-cp27mu-manylinux1_x86_64.whl  jsonpointer-1.10-py2-none-any.whl             pycparser-2.17.tar.gz                 stevedore-1.23.0-py2.py3-none-any.whl
     chardet-3.0.4-py2.py3-none-any.whl             keystoneauth1-2.21.0-py2.py3-none-any.whl     PyYAML-3.12.tar.gz                    urllib3-1.21.1-py2.py3-none-any.whl
     deprecation-1.0.1.tar.gz                       openstacksdk-0.9.17-py2.py3-none-any.whl      rabbitmq-0.2.0-py2.py3-none-any.whl   wrapt-1.10.10.tar.gz
     idna-2.5-py2.py3-none-any.whl                  os_client_config-1.27.0-py2.py3-none-any.whl  requests-2.18.1-py2.py3-none-any.whl
</pre>

<p>
其中 <code>requiements.txt</code> 可能长这样，也就是所有希望安装的包：
</p>
<pre class="example">
     openstacksdk
     rabbitmq
</pre>

<p>
参考 <a href="https://pip.pypa.io/en/stable/reference/pip_install/#requirements-file-format">官方文档</a> ， <code>requirements.txt</code> 可能这么写：
</p>
<pre class="example">
     SomeProject
     SomeProject == 1.3
     SomeProject &gt;=1.2,&lt;.2.0
     SomeProject[foo, bar]
     SomeProject~=1.4.2
</pre>
<p>
<code>pip 6.0</code> 后的版本还可以支持“环境标记”：
</p>
<pre class="example">
     SomeProject ==5.4 ; python_version &lt; '2.7'
     SomeProject; sys_platform == 'win32'
</pre>

<p>
完成下载后，直接加参数安装即可：
</p>
<div class="org-src-container">
<pre class="src src-sh">     pip install --no-index --find-links=/tmp/downloads -r requirements.txt
</pre>
</div>
</div>
</div>

<div id="outline-container-org03907cb" class="outline-3">
<h3 id="org03907cb"><span class="section-number-3">25.4</span> 使用阿里源</h3>
<div class="outline-text-3" id="text-25-4">
<p>
这样可以全局修改，修改 =~/.pip/pip.conf=：
</p>
<div class="org-src-container">
<pre class="src src-conf-space">     [<span style="color: #00ff00;">global</span>]
     <span style="color: #8fbc8f;">trusted-host</span> =  mirrors.aliyun.com
     <span style="color: #8fbc8f;">index-url</span> = http://mirrors.aliyun.com/pypi/simple
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgba62fd2" class="outline-2">
<h2 id="orgba62fd2"><span class="section-number-2">26</span> print打印字典的特殊用法</h2>
<div class="outline-text-2" id="text-26">
<div class="org-src-container">
<pre class="src src-python">    <span style="color: #8fbc8f;">d</span> = {
        <span style="color: #ffa500;">'xie'</span>: <span style="color: #ffa500;">'peng'</span>,
        <span style="color: #ffa500;">'peng'</span>: <span style="color: #ffa500;">'nihao'</span>
    }

    <span style="color: PaleYellow;">print</span> d

    <span style="color: PaleYellow;">print</span> <span style="color: #ffa500;">'%(xie)s'</span> % d
    <span style="color: PaleYellow;">print</span> <span style="color: #ffa500;">'%(peng)s'</span> % d
</pre>
</div>
</div>
</div>

<div id="outline-container-orge5a163e" class="outline-2">
<h2 id="orge5a163e"><span class="section-number-2">27</span> 设置源文件编码</h2>
<div class="outline-text-2" id="text-27">
<div class="org-src-container">
<pre class="src src-python">    <span style="color: #cd5c5c;"># </span><span style="color: #cd5c5c;">-*- coding: utf-8; -*-</span>
    <span style="color: PaleYellow;">from</span> collections <span style="color: PaleYellow;">import</span> namedtuple
    <span style="color: PaleYellow;">from</span> enum <span style="color: PaleYellow;">import</span> Enum

    <span style="color: PaleYellow;">class</span> <span style="color: #00ff00;">Species</span>(Enum):
        <span style="color: #8fbc8f;">cat</span> = 1
        <span style="color: #8fbc8f;">dog</span> = 2
        <span style="color: #8fbc8f;">horse</span> = 3
        <span style="color: #8fbc8f;">aardvark</span> = 4
        <span style="color: #8fbc8f;">butterfly</span> = 5
        <span style="color: #8fbc8f;">owl</span> = 6
        <span style="color: #8fbc8f;">platypus</span> = 7
        <span style="color: #8fbc8f;">dragon</span> = 8
        <span style="color: #8fbc8f;">unicorn</span> = 9
        <span style="color: #cd5c5c;"># </span><span style="color: #cd5c5c;">&#20381;&#27425;&#31867;&#25512;</span>

        <span style="color: #cd5c5c;"># </span><span style="color: #cd5c5c;">&#20294;&#25105;&#20204;&#24182;&#19981;&#24819;&#20851;&#24515;&#21516;&#19968;&#29289;&#31181;&#30340;&#24180;&#40836;&#65292;&#25152;&#20197;&#25105;&#20204;&#21487;&#20197;&#20351;&#29992;&#19968;&#20010;&#21035;&#21517;</span>
        <span style="color: #8fbc8f;">kitten</span> = 1  <span style="color: #cd5c5c;"># </span><span style="color: #cd5c5c;">(&#35793;&#32773;&#27880;&#65306;&#24188;&#23567;&#30340;&#29483;&#21674;)</span>
        <span style="color: #8fbc8f;">puppy</span> = 2   <span style="color: #cd5c5c;"># </span><span style="color: #cd5c5c;">(&#35793;&#32773;&#27880;&#65306;&#24188;&#23567;&#30340;&#29399;&#29399;)</span>

    <span style="color: #8fbc8f;">Animal</span> = namedtuple(<span style="color: #ffa500;">'Animal'</span>, <span style="color: #ffa500;">'name age type'</span>)
    <span style="color: #8fbc8f;">perry</span> = Animal(name=<span style="color: #ffa500;">"Perry"</span>, age=31, <span style="color: #b0c4de;">type</span>=Species.cat)
    <span style="color: #8fbc8f;">drogon</span> = Animal(name=<span style="color: #ffa500;">"Drogon"</span>, age=4, <span style="color: #b0c4de;">type</span>=Species.dragon)
    <span style="color: #8fbc8f;">tom</span> = Animal(name=<span style="color: #ffa500;">"Tom"</span>, age=75, <span style="color: #b0c4de;">type</span>=Species.cat)
    <span style="color: #8fbc8f;">charlie</span> = Animal(name=<span style="color: #ffa500;">"Charlie"</span>, age=2, <span style="color: #b0c4de;">type</span>=Species.kitten)

    <span style="color: PaleYellow;">print</span> charlie.<span style="color: #b0c4de;">type</span> == tom.<span style="color: #b0c4de;">type</span>
    <span style="color: PaleYellow;">print</span> charlie.<span style="color: #b0c4de;">type</span>

    <span style="color: PaleYellow;">print</span> Species(1)
    <span style="color: PaleYellow;">print</span> Species[<span style="color: #ffa500;">'cat'</span>]
    <span style="color: PaleYellow;">print</span> Species.cat

</pre>
</div>
</div>
</div>

<div id="outline-container-orgf1c9f5c" class="outline-2">
<h2 id="orgf1c9f5c"><span class="section-number-2">28</span> python多继承的查找顺序</h2>
<div class="outline-text-2" id="text-28">
<div class="org-src-container">
<pre class="src src-artist">        (foo) P1                P2 (foo, bar)
              \                 /
              |\-             -/|
              |  \-         -/  |
              |    \-     -/    |
              |      \- -/      |
              |       -X-       |
              |     -/   \-     |
              |   -/       \-   |
              | -/           \- |
              |/               \|
              C1                C2 (bar)
              \                 /
               \               /
                \            -/
                 \          /
                 |         /
                  \      -/
                   \    /
                    \  /
                     GC
</pre>
</div>

<p>
新式类（广度优先）：
</p>
<div class="org-src-container">
<pre class="src src-python">    <span style="color: PaleYellow;">class</span> <span style="color: #00ff00;">P1</span>(<span style="color: #b0c4de;">object</span>):
        <span style="color: PaleYellow;">def</span> <span style="color: #9acd32;">foo</span>(<span style="color: PaleYellow;">self</span>):
            <span style="color: PaleYellow;">print</span> <span style="color: #ffa500;">'called P1-foo()'</span>

    <span style="color: PaleYellow;">class</span> <span style="color: #00ff00;">P2</span>(<span style="color: #b0c4de;">object</span>):
        <span style="color: PaleYellow;">def</span> <span style="color: #9acd32;">foo</span>(<span style="color: PaleYellow;">self</span>):
            <span style="color: PaleYellow;">print</span> <span style="color: #ffa500;">'called P2-foo()'</span>

        <span style="color: PaleYellow;">def</span> <span style="color: #9acd32;">bar</span>(<span style="color: PaleYellow;">self</span>):
            <span style="color: PaleYellow;">print</span> <span style="color: #ffa500;">'called P2-bar()'</span>

    <span style="color: PaleYellow;">class</span> <span style="color: #00ff00;">C1</span>(P1, P2):
        <span style="color: PaleYellow;">pass</span>

    <span style="color: PaleYellow;">class</span> <span style="color: #00ff00;">C2</span>(P1, P2):
        <span style="color: PaleYellow;">def</span> <span style="color: #9acd32;">bar</span>(<span style="color: PaleYellow;">self</span>):
            <span style="color: PaleYellow;">print</span> <span style="color: #ffa500;">'called C2-bar'</span>

    <span style="color: PaleYellow;">class</span> <span style="color: #00ff00;">GC</span>(C1, C2):
        <span style="color: PaleYellow;">pass</span>

    <span style="color: #8fbc8f;">gc</span> = GC()
    gc.foo()
    gc.bar()
    <span style="color: PaleYellow;">print</span> GC.__mro__

</pre>
</div>

<p>
从新式类中的 <code>__mro__</code> 属性可以知道查找顺序是怎样的。
</p>

<p>
旧式类（深度优先）：
</p>
<div class="org-src-container">
<pre class="src src-python">    <span style="color: PaleYellow;">class</span> <span style="color: #00ff00;">P1</span>():
        <span style="color: PaleYellow;">def</span> <span style="color: #9acd32;">foo</span>(<span style="color: PaleYellow;">self</span>):
            <span style="color: PaleYellow;">print</span> <span style="color: #ffa500;">'called P1-foo()'</span>

    <span style="color: PaleYellow;">class</span> <span style="color: #00ff00;">P2</span>():
        <span style="color: PaleYellow;">def</span> <span style="color: #9acd32;">foo</span>(<span style="color: PaleYellow;">self</span>):
            <span style="color: PaleYellow;">print</span> <span style="color: #ffa500;">'called P2-foo()'</span>

        <span style="color: PaleYellow;">def</span> <span style="color: #9acd32;">bar</span>(<span style="color: PaleYellow;">self</span>):
            <span style="color: PaleYellow;">print</span> <span style="color: #ffa500;">'called P2-bar()'</span>

    <span style="color: PaleYellow;">class</span> <span style="color: #00ff00;">C1</span>(P1, P2):
        <span style="color: PaleYellow;">pass</span>

    <span style="color: PaleYellow;">class</span> <span style="color: #00ff00;">C2</span>(P1, P2):
        <span style="color: PaleYellow;">def</span> <span style="color: #9acd32;">bar</span>(<span style="color: PaleYellow;">self</span>):
            <span style="color: PaleYellow;">print</span> <span style="color: #ffa500;">'called C2-bar'</span>

    <span style="color: PaleYellow;">class</span> <span style="color: #00ff00;">GC</span>(C1, C2):
        <span style="color: PaleYellow;">pass</span>

    <span style="color: #8fbc8f;">gc</span> = GC()
    gc.foo()
    gc.bar()

</pre>
</div>

<p>
旧式类中没有 <code>__mro__</code> 属性。
</p>
</div>
</div>

<div id="outline-container-org9ca63b1" class="outline-2">
<h2 id="org9ca63b1"><span class="section-number-2">29</span> 使用dis模块来查看python字节码</h2>
<div class="outline-text-2" id="text-29">
<div class="org-src-container">
<pre class="src src-python">    <span style="color: PaleYellow;">import</span> dis
    <span style="color: #8fbc8f;">code_obj</span> = <span style="color: #b0c4de;">compile</span>(<span style="color: #ffa500;">'sum([1,2,3])'</span>,  <span style="color: #ffa500;">''</span>, <span style="color: #ffa500;">'single'</span>)
    <span style="color: #cd5c5c;"># </span><span style="color: #cd5c5c;">exec(code_obj)</span>
    dis.dis(code_obj)

</pre>
</div>

<div class="org-src-container">
<pre class="src src-python">    <span style="color: PaleYellow;">import</span> dis
    <span style="color: PaleYellow;">def</span> <span style="color: #9acd32;">f</span>():
        <span style="color: #8fbc8f;">i</span> = 0
        <span style="color: PaleYellow;">print</span> i

    dis.dis(f.func_code)

</pre>
</div>
</div>
</div>

<div id="outline-container-orgb6a24bc" class="outline-2">
<h2 id="orgb6a24bc"><span class="section-number-2">30</span> tornado</h2>
<div class="outline-text-2" id="text-30">
<p>
这是一个 <code>tornado</code> 的hello,world的例子。
</p>
<div class="org-src-container">
<pre class="src src-python">  <span style="color: PaleYellow;">import</span> tornado.ioloop
  <span style="color: PaleYellow;">import</span> tornado.web

  <span style="color: PaleYellow;">class</span> <span style="color: #00ff00;">MainHandler</span>(tornado.web.RequestHandler):
      <span style="color: PaleYellow;">def</span> <span style="color: #9acd32;">get</span>(<span style="color: PaleYellow;">self</span>):
          <span style="color: PaleYellow;">self</span>.write(<span style="color: #ffa500;">"Hello, world, this is test haha"</span>)

  <span style="color: PaleYellow;">def</span> <span style="color: #9acd32;">make_app</span>():
      <span style="color: PaleYellow;">return</span> tornado.web.Application([
          (r<span style="color: #ffa500;">"/"</span>, MainHandler),
      ])

  <span style="color: PaleYellow;">if</span> <span style="color: #b0c4de;">__name__</span> == <span style="color: #ffa500;">"__main__"</span>:
      <span style="color: #8fbc8f;">app</span> = make_app()
      app.listen(8888)
      tornado.ioloop.IOLoop.current().start()
</pre>
</div>
</div>
</div>

<div id="outline-container-org9e89e3b" class="outline-2">
<h2 id="org9e89e3b"><span class="section-number-2">31</span> vobject可以操作vCards文件</h2>
<div class="outline-text-2" id="text-31">
<p>
读：
</p>
<div class="org-src-container">
<pre class="src src-python">    <span style="color: PaleYellow;">import</span> vobject

    <span style="color: #8fbc8f;">card</span> = vobject.vCard()

    <span style="color: #8fbc8f;">s</span> = <span style="color: #b0c4de;">open</span>(<span style="color: #ffa500;">'test.vcf'</span>, <span style="color: #ffa500;">'r'</span>).read()

    <span style="color: PaleYellow;">print</span> <span style="color: #b0c4de;">dir</span>(vobject)
    <span style="color: #8fbc8f;">v</span> = vobject.readComponents( s )
    <span style="color: PaleYellow;">for</span> i <span style="color: PaleYellow;">in</span> v:
        <span style="color: PaleYellow;">if</span> <span style="color: PaleYellow;">not</span> (<span style="color: #ffa500;">'fuhuayuqi'</span> <span style="color: PaleYellow;">in</span> <span style="color: #b0c4de;">str</span>(i.contents.get(<span style="color: #ffa500;">'n'</span>)[0].value)):
            <span style="color: PaleYellow;">print</span> <span style="color: #ffa500;">'not fuhuayuqi contacts'</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org85809e6" class="outline-2">
<h2 id="org85809e6"><span class="section-number-2">32</span> python解析html</h2>
<div class="outline-text-2" id="text-32">
<p>
取得所有的a标签：
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #cd5c5c;"># </span><span style="color: #cd5c5c;">-*- coding: utf-8; -*-</span>
<span style="color: #cd5c5c;">#</span><span style="color: #cd5c5c;">!/usr/bin/python</span>
<span style="color: PaleYellow;">from</span> bs4 <span style="color: PaleYellow;">import</span> BeautifulSoup

<span style="color: PaleYellow;">import</span> sys
<span style="color: PaleYellow;">import</span> urllib2
<span style="color: #b0c4de;">reload</span>(sys)
sys.setdefaultencoding(<span style="color: #ffa500;">'utf8'</span>)

<span style="color: #8fbc8f;">html</span> = <span style="color: #ffa500;">"""</span>

<span style="color: #ffa500;">&lt;a href="http://www.baidu.com"&gt;this_is_test_1&lt;/a&gt;</span>

<span style="color: #ffa500;">&lt;a href="http://www.baidu.com2"&gt;this_is_test_2&lt;/a&gt;</span>

<span style="color: #ffa500;">"""</span>

<span style="color: #8fbc8f;">soup</span> = BeautifulSoup(html, <span style="color: #ffa500;">"html.parser"</span>)

<span style="color: PaleYellow;">for</span> i <span style="color: PaleYellow;">in</span> [tag <span style="color: PaleYellow;">for</span> tag <span style="color: PaleYellow;">in</span> soup.find_all(<span style="color: #ffa500;">'a'</span>)]:
    <span style="color: #8fbc8f;">url</span> = i[<span style="color: #ffa500;">'href'</span>].strip()
    <span style="color: #8fbc8f;">name</span> = i.string.strip() + <span style="color: #ffa500;">".mp3"</span>
    <span style="color: PaleYellow;">print</span> <span style="color: #ffa500;">"download "</span> + name + <span style="color: #ffa500;">" from "</span> + url + <span style="color: #ffa500;">"..."</span>

</pre>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: pengpengxp</p>
<p class="date">Created: 2019-03-18 一 16:39</p>
<p class="validation"></p>
</div>
</body>
</html>
